# 首次生成安装包完整指南

本指南将帮助您第一次成功生成 DonTouchMe 的 Windows 安装包。

---

## 准备工作（一次性）

### ✅ 检查清单
在生成安装包前，请确认：

- [ ] 已安装 Python 3.8+
- [ ] 已安装 PyInstaller (`pip install pyinstaller`)
- [ ] **已安装 Inno Setup**（如果还没有，请看下一节）
- [ ] 已完成 PyInstaller 打包（存在 `dist/DonTouchMe/` 文件夹）

---

## 第一步：安装 Inno Setup

**如果已经安装，跳过此步骤。**

### 快速安装
1. 阅读 `Inno_Setup_安装指南.md`
2. 访问 https://jrsoftware.org/isdl.php
3. 下载并安装 Inno Setup 6.x
4. 使用默认安装路径

### 验证安装
运行检测脚本：
```
双击 check_innosetup.bat
```

如果显示 `✅ Inno Setup 已正确安装`，说明成功！

---

## 第二步：生成安装包

### 方法 A：一键生成（推荐）

**直接双击 `build_all.bat`**

这会自动执行：
1. PyInstaller 打包程序
2. Inno Setup 生成安装包

### 方法 B：分步生成

如果已经有 `dist/DonTouchMe/` 文件夹：

**双击 `build_installer.bat`**

只生成安装包，不重新打包程序。

---

## 第三步：等待生成

生成过程约需 **1-3 分钟**，取决于您的电脑性能。

### 正常输出示例
```
========================================
DonTouchMe 安装包生成工具
========================================

[步骤 1/4] 检查 Inno Setup 是否安装...
✅ Inno Setup 已安装
   路径: C:\Program Files (x86)\Inno Setup 6\ISCC.exe

[步骤 2/4] 检查可执行文件...
✅ 找到可执行文件

[步骤 3/4] 检查依赖文件...
✅ 依赖文件完整

[步骤 4/4] 生成安装程序...
正在编译 installer.iss...

Inno Setup Compiler 6.x.x
Copyright (C) 1997-2024 Jordan Russell

[编译输出...]

========================================
✅ 安装包生成成功！
========================================

输出位置:
   installer_output\DonTouchMe_Setup_v1.0.0.exe
   大小: 50-60 MB
```

---

## 第四步：找到安装包

生成成功后，安装包位于：

```
DonTouchMe/
└── installer_output/
    └── DonTouchMe_Setup_v1.0.0.exe  ← 这就是安装包！
```

文件大小约 **50-60 MB**

---

## 第五步：测试安装包

### 建议测试流程

1. **双击安装包**
   - 文件：`installer_output\DonTouchMe_Setup_v1.0.0.exe`

2. **安装向导**
   - Welcome → Next
   - Select Destination → Next（或自定义路径）
   - Select Additional Tasks → 勾选需要的选项
   - Ready to Install → Install
   - Setup completed → Finish

3. **测试程序**
   - 从开始菜单或桌面快捷方式启动
   - 检查系统托盘图标
   - 配置 PushPlus Token
   - 测试手动触发功能

4. **测试卸载**
   - 控制面板 → 程序和功能 → 卸载 DonTouchMe
   - 或：开始菜单 → DonTouchMe → 卸载

---

## 常见问题排查

### ❌ 问题 1：找不到 Inno Setup
**错误信息**：
```
❌ 错误: 未找到 Inno Setup!
```

**解决方法**：
1. 运行 `check_innosetup.bat` 检测
2. 如果未安装，参考 `Inno_Setup_安装指南.md`
3. 确保安装到默认路径

---

### ❌ 问题 2：找不到可执行文件
**错误信息**：
```
❌ 错误: 未找到可执行文件!
```

**解决方法**：
先运行 PyInstaller 打包：
```bash
python -m PyInstaller DonTouchMe.spec --clean
```

---

### ❌ 问题 3：语言文件错误（已修复）
**错误信息**：
```
Error: Cannot find language file "ChineseSimplified.isl"
```

**解决方法**：
这个问题已经修复。如果仍然出现，说明您使用的是旧版 `installer.iss`。

更新方法：
1. 从 Git 获取最新的 `installer.iss`
2. 或手动修改 `[Languages]` 部分为：
```ini
[Languages]
Name: "english"; MessagesFile: "compiler:Default.isl"
```

---

### ❌ 问题 4：生成失败，乱码错误
**可能原因**：
- 文件路径包含中文
- 权限不足

**解决方法**：
1. 确保项目路径不包含中文
2. 以管理员身份运行 `build_installer.bat`

---

### ❌ 问题 5：安装包无法运行
**症状**：双击安装包没有反应

**解决方法**：
1. 检查 Windows Defender 是否拦截
2. 右键安装包 → 属性 → 解除锁定
3. 暂时禁用杀毒软件

---

## 下一步：分发安装包

### 分发方式

#### 1. 网盘分享
- 上传到百度网盘、阿里云盘、OneDrive
- 分享下载链接

#### 2. GitHub Releases（推荐）
```bash
# 创建版本标签
git tag v1.0.0
git push origin v1.0.0

# 在 GitHub 仓库创建 Release
# 上传 DonTouchMe_Setup_v1.0.0.exe
```

#### 3. 直接发送
- 通过微信、QQ、邮件发送
- 注意：大文件可能需要压缩

### 用户使用流程
1. 下载 `DonTouchMe_Setup_v1.0.0.exe`
2. 双击安装
3. 完成！

**用户不需要**：
- ❌ 安装 Python
- ❌ 安装任何依赖
- ❌ 安装 Inno Setup
- ❌ 运行任何命令

---

## 成功指标

✅ `installer_output/DonTouchMe_Setup_v1.0.0.exe` 存在
✅ 文件大小约 50-60 MB
✅ 可以双击启动安装向导
✅ 安装完成后程序正常运行
✅ 可以正常卸载

---

## 后续更新流程

当您修改代码需要发布新版本时：

```bash
# 1. 更新版本号（installer.iss）
# 2. 重新打包和生成
双击 build_all.bat

# 3. 测试新版本
双击 installer_output\DonTouchMe_Setup_v1.0.1.exe

# 4. 发布
上传到 GitHub Releases
```

---

## 获取帮助

遇到问题？

1. **查看详细文档**
   - `Inno_Setup_安装指南.md` - Inno Setup 安装
   - `创建安装包指南.md` - 完整的打包教程
   - `安装包生成完成说明.md` - 总体说明

2. **运行检测工具**
   - `check_innosetup.bat` - 检测 Inno Setup
   - `build_installer.bat` - 查看详细错误

3. **GitHub Issues**
   - 提交问题到 https://github.com/woodmeone/DonTouchMe/issues

---

## 总结

🎯 **三步生成安装包**：
1. 安装 Inno Setup（一次性）
2. 双击 `build_all.bat`
3. 获得 `DonTouchMe_Setup_v1.0.0.exe`

📤 **用户使用**：
1. 下载安装包
2. 双击安装
3. 使用程序

就是这么简单！🚀
