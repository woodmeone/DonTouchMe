# DonTouchMe 测试指南

## 测试环境准备

### 前置条件
- ✅ Python 3.8+ 已安装
- ✅ 依赖包已安装（`pip install -r requirements.txt`）
- ⚠️ 摄像头可用
- ⚠️ PushPlus Token 已配置（可选，测试通知功能时需要）

## 测试计划

### 阶段 A：基础功能测试（无需重启）

#### Test 1: 查看程序信息
```bash
python src/main.py info
```
**预期结果**：显示程序版本、作者、功能列表

#### Test 2: 查看配置
```bash
python src/main.py config --show
```
**预期结果**：显示完整配置信息

#### Test 3: 测试所有组件
```bash
python src/main.py test
```
**预期结果**：
- 摄像头：[成功] 或 [失败]（如果无摄像头）
- 截图：[成功]
- 通知：[失败]（如果未配置 Token）或 [成功]

#### Test 4: 手动触发（无通知）
```bash
python src/main.py trigger --type manual
```
**预期结果**：
- 拍照成功（如果有摄像头）
- 截图成功
- 文件保存在 `data/captures/` 目录

#### Test 5: 检查生成的文件
```bash
# Windows
dir /s data\captures
```
**预期结果**：看到摄像头照片和截图文件

### 阶段 B：配置管理测试

#### Test 6: 修改配置
```bash
# 禁用摄像头
python src/main.py config --set camera.enabled=false

# 查看修改结果
python src/main.py config --show
```

#### Test 7: 恢复配置
```bash
# 启用摄像头
python src/main.py config --set camera.enabled=true
```

### 阶段 C：通知功能测试（需要 Token）

#### Test 8: 配置 Token
1. 访问 http://www.pushplus.plus/
2. 微信扫码关注获取 Token
3. 编辑 `data/config.json`，填入 Token
4. 重新测试

#### Test 9: 测试通知发送
```bash
python src/main.py trigger --type manual
```
**预期结果**：微信收到通知消息

### 阶段 D：任务计划测试（需要管理员权限）

#### Test 10: 检查任务计划状态（无需管理员权限）
```bash
python src/main.py install
```
**预期结果**：提示需要管理员权限

#### Test 11: 以管理员身份安装任务计划
1. 右键「命令提示符」→ 以管理员身份运行
2. 切换到项目目录
3. 执行：
```bash
python src/main.py install
```
**预期结果**：
- 显示「安装成功」
- 创建了两个任务：DonTouchMe_Boot 和 DonTouchMe_Wake

#### Test 12: 验证任务计划
1. 按 `Win + R`，输入 `taskschd.msc`
2. 在任务计划程序库中查找：
   - `DonTouchMe_Boot`
   - `DonTouchMe_Wake`

**预期结果**：两个任务都存在且状态为「就绪」

### 阶段 E：自动触发测试（需要重启/休眠）

#### Test 13: 开机触发测试
1. 确保任务计划已安装
2. 重启电脑
3. 开机后等待约 15 秒
4. 检查：
   - 日志文件 `logs/dontouchme_YYYYMMDD.log`
   - 微信通知（如果配置了 Token）
   - 新生成的照片和截图

**预期结果**：
- 日志中有「触发类型: boot」
- 生成新的照片和截图
- 收到微信通知

#### Test 14: 休眠唤醒触发测试
1. 让电脑进入休眠：开始菜单 → 电源 → 休眠
2. 等待 10 秒确保完全休眠
3. 按电源键唤醒电脑
4. 等待约 10 秒
5. 检查日志和通知

**预期结果**：
- 日志中有「触发类型: wake」
- 生成新的照片和截图
- 收到微信通知

#### Test 15: 卸载任务计划
```bash
# 以管理员身份运行
python src/main.py uninstall
```
**预期结果**：
- 显示「卸载成功」
- 任务计划程序中不再有 DonTouchMe 任务

## 故障排查

### 问题 1: 摄像头测试失败
**可能原因**：
- 摄像头被其他程序占用（如 Zoom、Teams）
- 摄像头权限未开启
- 没有摄像头设备

**解决方法**：
1. 关闭占用摄像头的程序
2. 检查 Windows 隐私设置 → 摄像头权限
3. 如果没有摄像头，可以禁用：`python src/main.py config --set camera.enabled=false`

### 问题 2: 通知测试失败
**可能原因**：
- Token 未配置或配置错误
- 网络问题
- PushPlus 服务异常

**解决方法**：
1. 确认 Token 正确
2. 测试网络连接
3. 访问 PushPlus 官网确认服务状态

### 问题 3: 任务计划安装失败
**可能原因**：
- 没有管理员权限
- Python 路径包含特殊字符
- 系统安全策略限制

**解决方法**：
1. 确保以管理员身份运行
2. 查看日志文件了解具体错误
3. 尝试使用安装脚本：`scripts/install_task.py`

### 问题 4: 开机/唤醒没有触发
**可能原因**：
- 任务计划未正确安装
- 延迟时间太短，系统还未准备好
- 权限问题

**解决方法**：
1. 确认任务计划存在且状态正常
2. 增加延迟时间（修改配置中的 delay_seconds）
3. 查看任务计划程序中的执行历史
4. 检查日志文件

## 测试检查表

### 基础功能
- [ ] 程序信息显示正常
- [ ] 配置显示正常
- [ ] 配置修改正常
- [ ] 组件测试正常
- [ ] 日志文件生成

### 核心功能
- [ ] 摄像头拍照成功（或已禁用）
- [ ] 屏幕截图成功
- [ ] 图片文件正确保存
- [ ] 手动触发成功

### 通知功能
- [ ] Token 已配置
- [ ] 通知发送成功
- [ ] 微信收到消息
- [ ] 图片正确显示

### 自动触发
- [ ] 任务计划安装成功
- [ ] 任务在任务计划程序中可见
- [ ] 开机自动触发成功
- [ ] 休眠唤醒触发成功
- [ ] 卸载功能正常

## 性能指标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 拍照耗时 | < 3 秒 | 包括预热时间 |
| 截图耗时 | < 1 秒 | |
| 通知发送 | < 5 秒 | 取决于网络 |
| 开机延迟 | 10 秒 | 可配置 |
| 唤醒延迟 | 5 秒 | 可配置 |

## 测试报告模板

```
测试时间：YYYY-MM-DD HH:MM
测试环境：Windows 版本 / Python 版本
摄像头：有/无

基础功能测试：
- 程序信息：✅/❌
- 配置管理：✅/❌
- 组件测试：✅/❌

核心功能测试：
- 摄像头拍照：✅/❌/N/A
- 屏幕截图：✅/❌
- 手动触发：✅/❌

通知功能测试：
- Token 配置：✅/❌
- 通知发送：✅/❌
- 图片显示：✅/❌

自动触发测试：
- 任务安装：✅/❌
- 开机触发：✅/❌/未测试
- 唤醒触发：✅/❌/未测试
- 任务卸载：✅/❌

问题和建议：
[在此填写遇到的问题和改进建议]
```

## 下一步

测试完成后，如果一切正常：
1. 保持任务计划安装状态，让程序自动运行
2. 定期查看日志文件
3. 关注微信通知

如果发现问题：
1. 记录问题详情
2. 查看日志文件
3. 提交 Issue 反馈
